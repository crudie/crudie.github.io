<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>Testing</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-md-8 offset-md-4">
            <div class="form-group">
                <label for="select-server">Selected Server</label>
                <select class="form-control" id="select-server">
                    <option value="" selected>Any</option>

                    <option value="104.243.43.122">NJ 2</option>
                    <option value="206.221.177.242">NJ 3</option>

                    <option value="156.96.46.106">Pennsylvania 1</option>
                    <option value="156.96.47.101">Pennsylvania 2</option>

                    <option value="62.149.17.179">Kiev 1</option>
                </select>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-4">
            <div class="form-group">
                <label for="select-video">Selected Video</label>
                <select class="form-control" id="select-video">
                    <option value="RhcvCZtNW9s">Sony 4K Ultra (30 Sec)</option>
                    <option value="j6SUpqZmp4o" selected>Honda Commercial (1 Min)</option>
                    <option value="vr0qNXmkUJ8">GoPro Hero (4.5 Min)</option>
                    <option value="Pbzn79TSRO0">Iceland 4K (1 Hour)</option>
                </select>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-4">
            <textarea id="output" class="form-control" style="width: 100%; height: 250px;"></textarea>
            <br/>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-3">
            <div id="player"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6 offset-md-3">
            <button id="copy" class="btn btn-lg btn-success" onclick="copyToClipboard('output')">Copy to Clipboard
            </button>
            <button id="tech-info" class="btn btn-lg btn-success" onclick="showTechInfo()">Show Tech Info</button>
        </div>
    </div>
</div>

<script>
    function copyToClipboard(elementId) {
        var aux = document.createElement("input");

        // Get the text from the element passed into the input
        aux.setAttribute("value", document.getElementById(elementId).value);

        // Append the aux input to the body
        document.body.appendChild(aux);

        // Highlight the content
        aux.select();

        // Execute the copy command
        document.execCommand("copy");

        // Remove the input from the body
        document.body.removeChild(aux);

    }

    // 2. This code loads the IFrame Player API code asynchronously.
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 3. This function creates an <iframe> (and YouTube player)
    //    after the API code downloads.
    var player;

    var t = setInterval(onEverySecond, 1000);

    var state;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '360',
            width: '100%',
            videoId: 'j6SUpqZmp4o',
            autoplay: '1',
            events: {
                //'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onEverySecond() {
        if (player && state === YT.PlayerState.PLAYING) {
            var textarea = document.getElementById('output');

            var content = new Date().toLocaleString() + " " + player.getCurrentTime().toFixed(2) + " " + player.getPlaybackQuality() + "; \n";

            textarea.value += content;
        }
    }

    function onPlayerStateChange(event) {
        state = event.data;
    }


    function showTechInfo() {
        player.showVideoInfo();
    }

    var selectVideo = document.getElementById('select-video');

    selectVideo.addEventListener('change', function () {
        // Reset content
        document.getElementById('output').value = "";

        player.loadVideoById(this.value);
    });

    var selectServer = document.getElementById('select-server');

    selectServer.addEventListener('change', function () {
        var value = this.value;

        var xhr = new XMLHttpRequest();

        // other commonly used name: xhttp, xmlHttp
        xhr.onreadystatechange = function (event) {
            if (this.readyState == 4 && this.status == 200) {
                console.log(xhr.response);
            }
        }

        xhr.open('GET', "https://mobileapi.privatewifi.com/mobile_api/vo_testing.php?server_ip=" + this.value, true);

        // true means asynchonous request-response.
        // false for synchorous is deprecated.
        xhr.send()
    });
</script>
</body>
</html>
